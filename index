<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>تبدیل گفتار به متن فارسی</title>
  <style>
    body {
      font-family: Tahoma, sans-serif;
      direction: rtl;
      text-align: right;
      background-color: #f5f5f5;
      margin: 0;
      padding: 20px;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    button {
      padding: 10px 15px;
      font-size: 16px;
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 4px;
    }

    button:hover {
      background-color: #45a049;
    }

    #output {
      width: 100%;
      height: 150px;
      margin-top: 10px;
      padding: 10px;
      font-size: 16px;
      direction: rtl;
      text-align: right;
    }

    #saveBtn {
      display: none;
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>تبدیل گفتار به متن فارسی</h1>
    <button id="recordBtn">ضبط صدا</button>
    <textarea id="output" placeholder="متن تبدیل شده اینجا نمایش داده می‌شود..."></textarea>
    <button id="saveBtn">ذخیره ویرایش</button>
  </div>

  <script>
    const recordBtn = document.getElementById('recordBtn');
    const output = document.getElementById('output');
    const saveBtn = document.getElementById('saveBtn');
    let isRecording = false;
    let audioChunks = [];

    recordBtn.onclick = () => {
      if (!isRecording) {
        navigator.mediaDevices.getUserMedia({ audio: true })
          .then(stream => {
            const mediaRecorder = new MediaRecorder(stream);
            mediaRecorder.start();
            isRecording = true;
            recordBtn.textContent = "در حال ضبط...";

            mediaRecorder.ondataavailable = e => {
              audioChunks.push(e.data);
            };

            mediaRecorder.onstop = () => {
              const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
              const formData = new FormData();
              formData.append('audio', audioBlob);

              // فعلاً فقط یک پیام نمایش می‌دهیم
              // بعداً می‌توانید اینجا درخواست API بزنید
              output.value = "صدا ضبط شد. در حال حاضر نیاز به اتصال به سرور دارد.";
              saveBtn.style.display = 'block';

              audioChunks = [];
            };

            recordBtn.onclick = () => {
              mediaRecorder.stop();
              stream.getTracks().forEach(track => track.stop());
              recordBtn.textContent = "ضبط صدا";
              isRecording = false;
              recordBtn.onclick = () => {
                // بازنشانی دکمه
              };
            };
          })
          .catch(err => {
            alert("خطا در دسترسی به میکروفون: " + err.message);
          });
      }
    };

    saveBtn.onclick = () => {
      const correctedText = output.value;
      if (correctedText.trim() === "") {
        alert("لطفاً متن را ویرایش کنید.");
        return;
      }
      alert("متن ویرایش شده ذخیره شد: " + correctedText);
      // بعداً می‌توانید این متن را به سرور ارسال کنید
    };
  </script>

</body>
</html>